-- Crear la base de datos
CREATE DATABASE guarderia;
USE guarderia;

-- Crear la tabla Roles
CREATE TABLE Roles (
    rolId INT AUTO_INCREMENT PRIMARY KEY,
    nombreRol VARCHAR(50) UNIQUE NOT NULL
);

-- Crear la tabla Usuarios con una columna rolId que hace referencia a Roles
CREATE TABLE Usuarios (
    usuarioId INT AUTO_INCREMENT PRIMARY KEY,
    nombreUsuario VARCHAR(50) UNIQUE NOT NULL,
    contrasena VARCHAR(255) NOT NULL,
    rolId INT NOT NULL,
    dni INT UNIQUE NOT NULL,
    nombres VARCHAR(50) NOT NULL,
    apellidos VARCHAR(50) NOT NULL,
    pregunta VARCHAR(50) NOT NULL,
    respuesta VARCHAR(50) NOT NULL,
    ultimoCambio DATE,
    FOREIGN KEY (rolId) REFERENCES Roles(rolId)
);

-- Crear la tabla Ingredientes
CREATE TABLE Ingredientes (
    ingredienteId INT AUTO_INCREMENT PRIMARY KEY,
    nombreIngrediente VARCHAR(50) UNIQUE NOT NULL
);

-- Crear la tabla Acudiente
CREATE TABLE Acudiente (
    cedula INT PRIMARY KEY,
    nombre VARCHAR(100),
    direccion VARCHAR(255),
    parentesco VARCHAR(50),
    numeroCuenta VARCHAR(20)
);

-- Crear la tabla Ninos (agregando la columna fechaIngreso)
CREATE TABLE Ninos (
    noMatricula INT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    acudienteCedula INT NOT NULL,
    fechaNacimiento DATE,
    fechaIngreso DATE,
    fechaFin DATE,
    estado VARCHAR(20),
    FOREIGN KEY (acudienteCedula) REFERENCES Acudiente(cedula)
);

-- Crear la tabla Alergias
CREATE TABLE Alergias (
    noMatricula INT,
    ingredienteId INT,
    observaciones TEXT,
    PRIMARY KEY (noMatricula, ingredienteId),
    FOREIGN KEY (noMatricula) REFERENCES Ninos(noMatricula) ON DELETE CASCADE,
    FOREIGN KEY (ingredienteId) REFERENCES Ingredientes(ingredienteId) ON DELETE CASCADE
);

-- Crear la tabla Consumos (agregando la columna fechaConsumo)
CREATE TABLE Consumos (
    consumoId INT AUTO_INCREMENT PRIMARY KEY,
    noMatricula INT,
    mes INT,
    costoPorComida DECIMAL(10, 2),
    fechaConsumo DATE,
    FOREIGN KEY (noMatricula) REFERENCES Ninos(noMatricula)
);

-- Crear la tabla MenusComidas (nombre general del menú)
CREATE TABLE MenuComidas (
    noMenu INT AUTO_INCREMENT PRIMARY KEY,
    nombreMenu VARCHAR(100) NOT NULL
);

-- Crear la tabla Platos (cada plato pertenece a un menú)
CREATE TABLE Platos (
    platoId INT AUTO_INCREMENT PRIMARY KEY,
    nombrePlato VARCHAR(100) NOT NULL,
    noMenu INT,  -- Relaciona los platos con los menús
    FOREIGN KEY (noMenu) REFERENCES MenuComidas(noMenu)
);

-- Crear la tabla IngredientesPlatos
CREATE TABLE IngredientesPlatos (
    platoId INT,
    ingredienteId INT,
    PRIMARY KEY (platoId, ingredienteId),
    FOREIGN KEY (platoId) REFERENCES Platos(platoId),
    FOREIGN KEY (ingredienteId) REFERENCES Ingredientes(ingredienteId)
);

-- Crear la tabla RegistroComidas
CREATE TABLE RegistroComidas (
    idRegistro INT AUTO_INCREMENT PRIMARY KEY,
    fecha DATE NOT NULL,
    noMenu INT,
    noMatricula INT,
    FOREIGN KEY (noMenu) REFERENCES MenuComidas(noMenu),
    FOREIGN KEY (noMatricula) REFERENCES Ninos(noMatricula)
);

-- Crear la tabla TelefonosAcudiente
CREATE TABLE TelefonosAcudiente (
    telefonoId INT AUTO_INCREMENT PRIMARY KEY,
    cedula INT,
    telefono VARCHAR(15),
    FOREIGN KEY (cedula) REFERENCES Acudiente(cedula)
);

-- Crear la tabla PagosCotizantes
CREATE TABLE PagosCotizantes (
    pagoId INT AUTO_INCREMENT PRIMARY KEY,
    cedula INT,
    noMatricula INT,
    valorPago DECIMAL(10, 2),
    fechaPago DATE,
    estado VARCHAR(20),
    FOREIGN KEY (cedula) REFERENCES Acudiente(cedula),
    FOREIGN KEY (noMatricula) REFERENCES Ninos(noMatricula)
);

-- Insertar datos en Roles
INSERT INTO Roles (nombreRol) VALUES 
('Profesor'), 
('Administrador');

-- Insertar datos en Usuarios
INSERT INTO Usuarios (nombreUsuario, contrasena, rolId, dni, nombres, apellidos, pregunta, respuesta, ultimoCambio) VALUES
('jmartinez', '123', 1, 11223344, 'jhon', 'martinez', 'Mascota favorita', 'manuelita','2024-11-28'),
('asanchez', '456', 1, 123123123, 'andrea', 'sanchez', 'Lugar favorito', 'barcelona','2024-01-28'),
('mlopez', '789', 1, 111111111, 'maria', 'lopez', 'Comida favorita', 'pasta','2023-11-20'),
('rgarcia', '123', 2, 222222222, 'rocio', 'garcia', 'Pelicula favorita', 'la llegada','2024-11-01'),
('gfernandez', 'admin456', 2, 333333333, 'gabriel', 'fernandez', 'Cosa favorita', 'carro','2023-11-01');

-- Insertar datos en Ingredientes
INSERT INTO Ingredientes (nombreIngrediente) VALUES
('Leche'),
('Pan'),
('Pollo'),
('Arroz'),
('Verduras'),
('Frutas'),
('Pasta'),
('Huevo'),
('Queso'),
('Carne'),
('Tomate'),
('Pepino'),
('Acelga'),
('Salmón'),
('Patatas');

-- Insertar datos en Acudiente
INSERT INTO Acudiente (cedula, nombre, direccion, parentesco, numeroCuenta) VALUES
(101010, 'Pedro Perez', 'Calle Falsa 123', 'Padre', '1234567890'),
(102020, 'Maria Lopez', 'Calle Real 456', 'Madre', '0987654321'),
(103030, 'Juan Garcia', 'Avenida Siempre Viva 789', 'Padre', '1122334455'),
(104040, 'Ana Torres', 'Carrera 12 345', 'Madre', '2233445566'),
(105050, 'Carlos Ramirez', 'Calle 5, Zona 6', 'Padre', '3344556677'),
(106060, 'Luisa Martell', 'Calle Luna 456', 'Madre', '4455667788'),
(107070, 'Jose Jimenez', 'Avenida Libertad 123', 'Padre', '5566778899'),
(108080, 'Claudia Hernandez', 'Calle Sol 789', 'Madre', '6677889900'),
(109090, 'Ricardo Vasquez', 'Calle del Río 321', 'Padre', '7788990011'),
(110101, 'Marta Paredes', 'Calle Alta 654', 'Madre', '8899001122');

-- Insertar datos en Ninos
INSERT INTO Ninos (noMatricula, nombre, acudienteCedula, fechaNacimiento, fechaIngreso, fechaFin, estado) VALUES
(1, 'Lucas Perez', 101010, '2021-01-01', '2023-09-01', NULL, 'Activo'),
(2, 'Martina Lopez', 102020, '2021-02-15', '2023-10-01', NULL, 'Activo'),
(3, 'Antonio Garcia', 103030, '2021-03-10', '2023-11-01', NULL, 'Activo'),
(4, 'Isabella Torres', 104040, '2021-04-20', '2023-08-01', NULL, 'Activo'),
(5, 'Mateo Ramirez', 105050, '2021-05-25', '2023-09-15', NULL, 'Activo'),
(6, 'Sofia Martell', 106060, '2021-06-30', '2023-10-05', NULL, 'Activo'),
(7, 'Samuel Jimenez', 107070, '2021-07-05', '2023-08-25', NULL, 'Activo'),
(8, 'Valentina Hernandez', 108080, '2021-08-11', '2023-09-10', NULL, 'Activo'),
(9, 'Felipe Vasquez', 109090, '2021-09-30', '2023-10-15', NULL, 'Activo'),
(10, 'Emilia Paredes', 110101, '2021-10-20', '2023-11-01', NULL, 'Activo');

-- Insertar datos en Alergias
INSERT INTO Alergias (noMatricula, ingredienteId, observaciones) VALUES
(1, 1, 'Requiere leche sin lactosa'),
(2, 3, 'No puede comer pollo'),
(3, 6, 'Alérgico a las verduras frescas'),
(4, 7, 'Sin pasta con gluten'),
(5, 9, 'No queso curado'),
(6, 5, 'Alergias a las patatas fritas'),
(7, 10, 'Le gusta el tomate');

-- Insertar datos en Consumos
INSERT INTO Consumos (noMatricula, mes, costoPorComida, fechaConsumo) VALUES
(1, 9, 50.000, '2024-09-01'),
(2, 10, 50.500, '2024-10-01'),
(3, 11, 60.000, '2024-11-01'),
(4, 8, 50.250, '2024-08-01'),
(5, 9, 50.750, '2024-09-15'),
(6, 10, 60.250, '2024-10-05'),
(7, 9, 50.000, '2024-09-25'),
(8, 10, 50.500, '2024-10-10'),
(9, 11, 60.000, '2024-11-05'),
(10, 11, 60.500, '2024-11-01');

-- Insertar datos en Menus
INSERT INTO MenuComidas (nombreMenu) VALUES
('Menú de la semana'),
('Menú vegano'),
('Menú infantil'),
('Menú saludable'),
('Menú especial'),
('Menú de Navidad');

-- Insertar datos en Platos
INSERT INTO Platos(nombrePlato, noMenu) VALUES
('Arroz con Pollo', 1),
('Ensalada de Quinoa', 2),
('Pasta con Albóndigas', 3),
('Sopa de Verduras', 4),
('Pechuga de Pollo a la Plancha', 5),
('Tarta de Frutas', 6),
('Pan con Aguacate', 2),
('Hamburguesa de Pavo', 3),
('Puré de Papas', 4),
('Pizza Vegetariana', 2),
('Tacos de Carne', 3),
('Arroz con Verduras', 4);

-- Insertar datos en IngredientesPlatos
INSERT INTO IngredientesPlatos (platoId, ingredienteId) VALUES
(1, 3),  -- Arroz con Pollo tiene Pollo
(1, 4),  -- Arroz con Pollo tiene Arroz
(2, 5),  -- Ensalada de Quinoa tiene Verduras
(2, 7),  -- Ensalada de Quinoa tiene Quinoa
(3, 4),  -- Pasta con Albóndigas tiene Pasta
(3, 8),  -- Pasta con Albóndigas tiene Albóndigas
(4, 5),  -- Sopa de Verduras tiene Verduras
(5, 3),  -- Pechuga de Pollo a la Plancha tiene Pollo
(5, 9),  -- Pechuga de Pollo a la Plancha tiene Queso
(6, 6),  -- Tarta de Frutas tiene Frutas
(7, 2),  -- Pan con Aguacate tiene Pan
(7, 5),  -- Pan con Aguacate tiene Aguacate
(8, 3),  -- Hamburguesa de Pavo tiene Carne
(8, 6),  -- Hamburguesa de Pavo tiene Queso
(9, 10), -- Puré de Papas tiene Papas
(10, 2), -- Pizza Vegetariana tiene Tomate
(10, 5), -- Pizza Vegetariana tiene Queso
(11, 3), -- Tacos de Carne tiene Carne
(12, 5); -- Pizza Vegetariana tiene Tomate

-- Insertar datos en RegistroComidas
INSERT INTO RegistroComidas (fecha, noMenu, noMatricula) VALUES
('2024-12-01', 1, 1),
('2024-12-01', 1, 2),
('2024-12-02', 2, 3),
('2024-12-02', 2, 4),
('2024-12-03', 3, 5),
('2024-12-03', 3, 6),
('2024-12-04', 4, 7),
('2024-12-04', 4, 8),
('2024-12-05', 5, 9),
('2024-12-05', 5, 10);

-- Insertar datos en TelefonosAcudiente
INSERT INTO TelefonosAcudiente (cedula, telefono) VALUES
(101010, '3001234567'),
(102020, '3002345678'),
(103030, '3003456789'),
(104040, '3004567890'),
(105050, '3005678901'),
(106060, '3006789012'),
(107070, '3007890123'),
(108080, '3008901234'),
(109090, '3009012345'),
(110101, '3000123456');

-- Insertar datos en PagosCotizantes
INSERT INTO PagosCotizantes (cedula, noMatricula, valorPago, fechaPago, estado) VALUES
(101010, 1, 500.000, '2024-12-01', 'Pagado'),
(102020, 2, 600.000, '2024-12-01', 'Pendiente'),
(103030, 3, 550.000, '2024-12-01', 'Pagado'),
(104040, 4, 700.000, '2024-12-01', 'Pagado'),
(105050, 5, 650.000, '2024-12-01', 'Pendiente'),
(106060, 6, 750.000, '2024-12-01', 'Pagado'),
(107070, 7, 800.000, '2024-12-01', 'Pendiente'),
(108080, 8, 500.000, '2024-12-01', 'Pagado'),
(109090, 9, 600.000, '2024-12-01', 'Pendiente'),
(110101, 10, 550.000, '2024-12-01', 'Pagado');
